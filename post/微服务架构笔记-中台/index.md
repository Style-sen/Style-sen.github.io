# 微服务架构笔记-中台


1. 在传统的前台-后台架构中，各个项目相对独立，许多项目都在重复发明同样的轮子，即让项目本身越来越臃肿，也让开发效率越来越低。
2. 为提高开发效率，我们有必要整合出一个中间组织，为所有的项目提供一些公共资源。而这个中间组织，就是人们所说的“中台”。
3. 适合从N到N+1的非创业公司。

## 大中台，小前台

1. 前台即包括各种和用户直接交互的界面，比如web页面，手机app；也包括服务端各种实时响应用户请求的业务逻辑，比如商品查询、订单系统等等。

### 业务中台

1. 各个项目的共通业务进行下沉，整合成通用的服务平台。

#### 搜索中心

#### 支付中心

#### 商品中心

#### 用户中心
1. 可以认为是一个基于微服务的类SAAS的综合身份管理中心，主要给公司平台内的业务系统使用。
2. 参考[业务中台建设系列（一）：用户中台V1](http://www.woshipm.com/pd/3409712.html)

##### 需求

###### To B
1. 统一管理下属账号，创建账号和注销账号；
2. 统一管理下属权限，避免越权接触数据或越权操作等；
3. 统一认证，所有系统只需要登录一次；
4. 统一审计，记录下属所有操作日志。
5. 组织如何注册。
6. 组织如何实名。
7. 组织如何登录（组织管理员如何登录）
8. 员工怎么登录，手机密码、手机短信验证码、第三方登录（微信、QQ、微博等）、账号名称/ID。
9. 怎么创建、删除、禁用员工账号。
10. 管理员怎么邀请员工加入到这个虚拟“组织”。
11. 组织如何分配员工权限（控制访问）。

###### To C
1. 需要登录么
2. 怎么登录，手机密码、手机短信验证码、第三方登录（微信、QQ、微博等）
3. 怎么注册，手机号注册、邮箱注册
4. 怎么能够注销账号
5. 是否需要实名，如何实名

##### 解决方案
1. 业内其实有很成熟的解决方案，比如4A管理和IAM。
```
4A管理：集中账号管理（Account）、集中认证管理（Authentication）、集中授权管理（Authorization）和集中审计管理（Audit）
IAM：Identity and Access Management，即身份识别与访问管理
```

##### 设计思路
1. 资源：（Resources页面、菜单、按钮、订单等）在`各个业务系统`中。
2. 权限： 访问和操作资源的许可（Permit删除、编辑、审批等）。
3. 角色： 角色也可以理解是权限的集合，是众多权限颗粒组成。【角色是与业务系统关联，业务系统限定了用户的角色】。
4. 用户： 系统实际的操作员（User）
5. 操作权限： 【页面权限】即用户登录系统可以看到的页面，由菜单来控制，菜单包括一级菜单或多级菜单。当系统赋予用户对应菜单的权限，那么用户就可以访问对应的菜单页面。【操作权限】：即页面的功能按钮，包括：查看、新增、修改、删除、审核等。当用户点击按钮时，系统将会校验用户的是否包含次操作权限，如果有，就可以进行下一步操作。【数据权限】 ：数据权限就是用户在同一页面看到的数据是不同的。
6. 注意：在用户中台中，资源归属于各业务系统，但权限（权限控制）却是属于用户中台！
7. 用户可以属于1个组织也可以属于多个组织，这些组织之间可以是相关联（比如集团公司和子公司），也可以不关联。
8. 【】【各个系统使用独立的组织（指组织机构）】，这样会更灵活一些。（有的业务系统需要组织架构来划分各种权限尤其是数据类权限）
9. 平台的账号分为两类，一类是个人账号，一类是组织账号（组织有政府机构、企业、社会团体等）。个人账号非常常见，全部的C端应用和部分B端应用都是基于个人账号体系的。

###### 账号体系
10. 组织账号的实现上其实有两种方式：一种是为组织创建独立的账号（曾经在政府OA系统中设计过）；一种是将个人账号绑定到组织进而通过个人账号来登录。后者在平台中非常常见，比如各类SAAS平台.
11. 在授权方面，个人账号和组织账号并无区别。

###### 权限管理
1. 用户中台的权限体系是基于RBAC概念，这个RBAC是【基于资源】的RBAC而非基于角色的RBAC。
2. 各业务系统的权限是相互独立的，没有依赖关系。
3. 业务系统的权限遵从于基于资源的RBAC。
4. 数据权限受限于数据规则
5. 权限并集：与 RBAC2 的静态职责分离-角色互斥原则相反，平台采用多角色权限取并集的设计。即在某个业务系统中，用户可以拥有多个角色。此时用户在该业务系统的权限等于各角色权限的并集
6. 为满足以上几点，权限体系中必须有系统标识；数据资源权限中不仅有组织标识，还必须要有部门标识和创建者标识，部门标识和创建者主要是便于区分消费者和生产者。
7. 用户组和角色组。

###### 总结
1. 个人账户统一原则：个人账户一次注册，全平台通用，类似于全网通行证和 SSO。
2. 业务权限独立原则：每个子系统的权限体系是独立的，但是由用户中台统一管理维护。『个人账户统一原则』明确了账户体系是统一的，但是对于每个子系统而言，每个账户所能使用的功能和服务，所能查看的数据权限是独立维护的。
3. 组织实体隔离原则：不同的组织实体之间，是相互隔离，独立管理的。每个组织实体可以自行组织自己的组织体系、账户体系和权限体系。不同的组织实体资源权限也是隔离的。
4. 从属关系隔离原则：个体账户与组织实体的从属关系是基于单独的业务系统存在的，『个人账户统一原则』明确的仅是个人账户的全网统一，但组织实体、从属关系并没有统一，并且是隔离的。
5. 如果要简化从属关系的管理，那么可以不遵循此原则，即个体账户与组织实体的从属关系是全平台统一的，与业务系统无关，但这会为降低平台的灵活性和扩展性。灵活性和复杂度之间通常要做一个取舍。

##### 业务实现

###### 功能模块
1. 账户
2. 认证
3. 组织管理
4. 权限管理
5. 授权管理
6. 鉴权中心
7. 系统管理

#### 交易中心

#### 营销中心

### 技术中台

#### MQ

#### RPC框架

#### 分布式事务

#### 分布式缓存

#### 容器

#### 分库分表

### 数据中台

#### 数据建模

#### 日志分析

#### 用户画像

### 算法中台

#### 语音识别

#### 图像识别

#### 搜索算法

#### 推荐算法

#### 人机对话

#### 垃圾过滤
