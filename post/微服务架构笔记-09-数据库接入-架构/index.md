# 微服务架构笔记-数据库-架构


# 原则
1. 高可用
2. 高性能
3. 一致性
4. 扩展性

# 方案

## 一：主备，主库读写，备库冗余
1. 性能一般。建立`高效的索引和引入缓存`来增加性能。
2. 扩展性差。通过`分库分表`来扩展。

## 二：双主架构，两个同时提供服务，负载均衡
1. 存在一致性问题。
2. 主键冲突问题。ID统一由`分布式ID生成服务`来生成。

## 三：主从架构，一主多从，读写分离
1. 主库挂了，影响写。
2. 存在一致性问题。

## 四：双主+主从架构
1. 存在一致性问题。
2. 同步更多。

## 解决一致性问题

### 主库和从库
1. 直接忽略。
2. 强制读主。增加读缓存。
3. 选择读主。缓存中增加标记，有标记读主，无标记读从。多了一层缓存读写。
4. 半同步复制。等同步完成，写请求才返回。后果：请求时延增长，吞吐量降低。
5. 数据库中间件。增加中间件成本更高。 

### DB和缓存
1. 延迟淘汰缓存，延迟时间大于同步时间。
