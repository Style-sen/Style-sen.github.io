# 容器镜像服务


## 容器镜像

1. 镜像中的应用尽量从环境变量获取配置参数；
2. 退而求其次，配置文件放在一个配置文件夹中，编排的时候可以挂载文件夹。

## 阿里云的容器镜像服务

### 产品功能
    1. 用户可以根据自己的业务需求，选择不同的地域创建和删除镜像仓库，提供稳定快速的镜像上传、下载服务；
    2. 每个镜像仓库都提供了公网、内网、VPC网络下对应的网络地址；
    3. 支持便捷的镜像安全扫描功能，展示详细的镜像层信息；
    4. 提供镜像漏洞报告，展示漏洞编号、漏洞等级、修复版本等多维度漏洞信息；
    5. 支持阿里云Code、GitHub、Bitbucket、自建GitLab的源代码构建源；
    6. 支持自动构建，源代码变更后实现自动构建成新Docker镜像；
    7. 支持海外构建，源代码在海外实现构建成新Docker镜像；
    8. 整合阿里云Code及CodePipeline，实现源代码到应用编译测试后，自动构建成新镜像；
    9. 整合容器服务，实现新镜像构建完成后便捷部署至容器服务集群。
    10. [通过配置镜像加速器可以提升获取Docker官方镜像的速度](https://help.aliyun.com/document_detail/60750.html?spm=a2c4g.11186623.4.3.43bf1e66F2XOnU)

### 操作使用
    1. `一般在企业账户下设置一个子账户来管理镜像服务`。
    2. 命名空间
        1) 作为一些仓库的集合，推荐将一个公司或组织的仓库集中在一个命名空间下面。
            以公司名称作为命名空间：aliyun、alibaba
            以团队、组织作为命名空间：misaka-team
        2) 目前每个主账号可以创建5个命名空间
    3. 创建镜像仓库
        1) 仓库作为一些镜像的集合，推荐将一个（应用或功能）不同版本的镜像放置在一个仓库中。
            以软件包作为仓库名称：centos、jetty
            以应用名作为仓库名称：console-web、console-service
        2) 创建过程中会选择关联代码库。
        3) 私有仓库，仓库是其他用户不可见的，只有有权限的账户登录才能进行下载。
    4. 管理镜像仓库

| 目录 | 功能 |
| -- | -- |
| 基本信息 | 查看并修改此镜像的基本信息 |
| 构建 | 设置构建规则， 并构建；查看构建日志`一般tag为发布版，master为latest班` |
| 仓库授权 | 支持RAM细粒度控制仓库的访问权限 |
| webhook | 提供仓库镜像的消息触发功能，当镜像上传之后主动触发用户设置的访问地址；串联镜像服务的下游流程,详见[触发器管理](https://help.aliyun.com/document_detail/60949.html?spm=a2c4g.11186623.6.553.53692b77fjPDtb) |
| 镜像版本 | 可以对镜像进行安全扫描，生成漏洞报告，并查看层信息 |
| 镜像同步 | |

    5. 部署应用
        点击，可以直接前往容器服务进行部署。
    6. docker基本操作

```shell
    docker login -u [user] -p [pw] [registry.cn-hangzhou.aliyuncs.com]
    docker pull registry.cn-hangzhou.aliyuncs.com/[命名空间]/[仓库名]:[版本]
    docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/[命名空间]/[仓库名]:[版本]
    docker push registry.cn-hangzhou.aliyuncs.com/[命名空间]/[仓库名]:[版本]
```

    7. 对上游的建议
        在编写项目代码时，配置信息一般从环境变量中获取，获取不到采用默认值。

### 缺点
    1. 构建失败之后，查看构建日志，很难定位到日志最后。

### 计费
    1. 目前容器镜像服务处于公测期间，免费提供镜像托管、镜像构建服务以及镜像加速器服务，请放心使用。

