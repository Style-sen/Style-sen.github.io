# 运维-选择公有云产品


## [UCLOUD](https://www.ucloud.cn/)

## [ALIYUN]()

### 公共云架构及解决方案

![栗子](/images/public_cloud/share.png)

1. web服务器，直达用户。
2. 业务支撑（OLTP）：业务服务器。
3. 查询服务:可以缓解业务服务压力。
4. BI服务:提供运营相关服务，需要收集各种日志、业务服务数据，存进大数据分析系统中。
5. 服务中间件：消息队列，日志服务，开放搜索等。

#### 网络架构

##### 定义云上网络环境

###### 专有网络VPC（私有）
1. 一个VPC是网络容器，相当于是一个无限扩容的私有机房。
2. 飞天洛神系统。 

##### 管理公网流量

###### 弹性公网EIP
1. 支持SNAT/DNAT，既可以让VPC ECS访问Internet，也可以让外部用户从Internet访问。
2. 一个EIP智能绑定一个云产品资源。
3. 多线BGP能力。
4. 一个公网IP。

###### 负载均衡SLB
1. 基于端口的负载均衡；
2. 支持TCP/UDP/HTTP/HTTPS；
3. 用户可自定义健康检查。
4. 没有SNAT功能。
5. 原则：需要两台ECS，而且这两个ECS分在两个可用区。

###### NAT网关
1. 支持SNAT/DNAT，可以让多台VPC ECS同时访问Internet，并让外部用户从Internet访问。

##### 节约公网成本

###### 共享流量包
1.一份公网带宽，一份公网流量，充分共享。
2. 闲时流量包，可用于从公网同步数据到云下。

###### 共享带宽
1. 一个公网IP，一份流量包。
2. 增强95计费。

##### 构建混合云

###### 高速通道
1. 物理专线，较麻烦。

###### 云托付
2. 托管物理主机。

###### VPN网关
1. SSL—VPN
2. IPsec-VPN

###### 智能接入网关
1. 提供设备（包含VPN网关）。
2. 或提供SDK。
2. 全网。

##### 连接全球网络 

###### 云企业网
1. 星形。
2. 打通私网。

###### 全球加速

#### 数据库架构
1. 各种数据库产品适应不同产品。不要自建数据库。

#### 存储架构

### ECS

#### 重启之后（注意事项）
1. 挂载硬盘；
2. 配置权限；
3. 实际业务测试。

#### 安全组

##### 概念

1. 网卡类型：
    VPC网络：只需要设置出方向或入方向的规则，不区分内网和公网。专有网络（VPC）实例的公网访问通过私网网卡映射完成，所以，您在实例内部看不到公网网卡，在安全组里也只能设置内网规则。您设置的安全组规则同时对内网和公网生效。
    经典网络：需要分别设置公网或内网的出方向或入方向规则。
2. 规则方向：
    出方向：是指ECS实例访问内网中其他ECS实例或者公网上的资源。
    入方向：是指内网中的其他ECS实例或公网上的资源访问ECS实例。
3. 不通安全组之间的ECS实例是内网不互通的，但是可以设置互通权限。

##### 默认安全组

##### 内网互联

###### 使用IP地址互联
1. 内网互联的实例数量较少。
2. 直接添加一条内网的安全组规则。

###### 加入到同一个安全组
1. 如果您的网络架构比较简单，实例中部署的业务相同，您就可以为所有的实例选择相同的安全组，绑定`同一安全组的实例之间不用设置特殊规则、默认是网络互通的`。
2. 也可以`将不同安全组加入到一个安全组`。
3. 缺点：适用于单一的应用架构，网络架构变更时需要做调整。

###### 绑定互通安全组
1. 为需要互通的实例新添加绑定一个`专门互通用的安全组`，适用于较为复杂的网络架构。
2. 新建一个安全组，命名为“互通安全组”，`不用给新建的安全组添加任何规则`。将需要互通的实例都添加绑定新建的“互通安全组”，利用同一安全组的实例之间默认互通的特性，达到内网实例互通的效果。

###### 安全组互信授权
1. 添加安全组规则时，使用安全组访问。

### 安全

#### SSL证书

##### 免费型 DV SSL 证书

1. 填写证书绑定的域名，这里的域名是子域名，不能写顶级域名；
2. 域名验证方式，如果域名使用的是阿里云的 DNS ，那么就可以直接用“自动 DNS验证”，只要这个域名是在账号名下，那么就自动添加 DNS 记录用于验证，否则就手动修改域名的 DNS 记录，或者上传验证文件到网站对应目录；CSR 生成方式默认选择系统生成。


### 备案

[阿里云文档](https://help.aliyun.com/product/35468.html?spm=a2c4g.11186623.6.540.560e3256EuaPDG)

#### ICP备案流程（APP端）

#### 管理查看ICP备案信息

##### 备案信息核查

###### 域名核验

##### 变更备案

###### 可变更备案信息

根据管局规则及规定，备案信息中的部分信息无法变更。
1. 根据相关规定，2019年4月22日起，变更网站信息时，`只能对网站域名进行删除，不能修改或新增域名`（除不能修改网站域名外，其他信息仍可以修改，例如联系方式、电子邮箱等）。
2. 变更备案时，`不能变更备案所在省份`。如需变更备案省份，需要重新申请一个目标省份的备案。
3. 有些省市管局不允许直接变更，或您的备案信息已经取消了在阿里云的接入导致无法变更。这种情况下，您需先注销备案后重新申请备案。

##### 阿里云备案账号维护

###### 找回备案账号

1. 判断是否需要导入或认领备案信息
    您可在阿里云登录名找回页面输入您备案的域名，拖动滑块完成认证后，单击立即找回，通过页面提示判断您是否需要导入或认领备案信息。

##### 原万网ICP备案信息导入阿里云

###### 导入原万网备案信息

1. 找回原万网备案登录账号及密码：准备资料->初始化邮箱->重置登录密码。
2. 导入原万网备案信息。
`如果目标账户有正在进行的订单，将不能导入`

### NAS文件系统

1. 毫秒级读写。

#### 挂载点

1. 挂载之前需要添加挂载点。
2. 一个挂载点可以有多个客户端连接。
3. 只有在挂载点安全组中的IP才能访问NAS。

#### ECS安装客户端

1. `sudo apt-get install nfs-common`
2. 修改同时发起的NFS请求数量：NFS客户端对于同时发起的NFS请求数量进行了控制，默认编译的内核中此参数值为2，严重影响性能，建议修改为128（使用ROOT用户）。
```
echo "options sunrpc tcp_slot_table_entries=128" >> /etc/modprobe.d/sunrpc.conf
echo "options sunrpc tcp_max_slot_table_entries=128" >>  /etc/modprobe.d/sunrpc.conf
```
3. 重启ECS
4. `cat /proc/sys/sunrpc/tcp_slot_table_entries`查看。

#### 配置自动挂载

1.  打开 /etc/fstab 配置文件；
2. 配置自动挂载
```
file-system-id.region.nas.aliyuncs.com:/ /mnt nfs vers=3,nolock,proto=tcp,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,_netdev,noresvport 0 0
```
3. reboot.

### RDS

1. 数据安全性：设置白名单。

### 块存储（系统盘和数据盘）

1. 微秒级读写。
2. `扩容比较麻烦`。
